# SSH Terrapin Prefix Truncation Weakness (CVE-2023-48795)Â 
To address the **SSH Terrapin Prefix Truncation Weakness** identified by Nessus Plugin ID **187315** (CVE-2023-48795), follow these steps to mitigate the vulnerability: 

  

## Understanding the Vulnerability 

The Terrapin attack is a prefix truncation vulnerability that allows a man-in-the-middle (MitM) attacker to bypass integrity checks and potentially downgrade the security of SSH connections. This vulnerability primarily affects SSH servers that support the **ChaCha20-Poly1305** cipher or CBC mode ciphers with Encrypt-then-MAC. 

  

## Mitigation Steps 

  

### 1. **Update OpenSSH** 

   - The first and most effective step is to **update OpenSSH** to the latest version that includes patches for this vulnerability. Check your distribution's package manager for available updates: 

     ```bash 

     sudo yum update openssh 

     ``` 

   - For systems using `dnf`, use: 

     ```bash 

     sudo dnf update openssh 

     ``` 

  

### 2. **Modify SSH Configuration** 

   - If an immediate update is not possible, you can mitigate the vulnerability by disabling the affected ciphers. Open the SSH daemon configuration file: 

     ```bash 

     sudo nano /etc/ssh/sshd_config 

     ``` 

   - Add or modify the `Ciphers` line to exclude the vulnerable ciphers: 

     ```plaintext 

     Ciphers -chacha20-poly1305@openssh.com 

     ``` 

   - If you have a `MACs` line, ensure it does not include any insecure MACs. 

  

### 3. **Apply Crypto Policies (if applicable)** 

   - On systems that support crypto policies, you can create a custom policy to disable the vulnerable ciphers: 

     1. Create a new policy module: 

        ```bash 

        sudo nano /etc/crypto-policies/policies/modules/TERRAPIN.pmod 

        ``` 

     2. Add the following lines: 

        ```plaintext 

        cipher@ssh = -CHACHA20* 

        ssh_etm = 0 

        ``` 

     3. Apply the new policy: 

        ```bash 

        sudo update-crypto-policies --set DEFAULT:TERRAPIN 

        ``` 

  

### 4. **Restart SSH Service** 

   - After making changes to the configuration, restart the SSH service to apply the updates: 

     ```bash 

     sudo systemctl restart sshd 

     ``` 

  

### 5. **Verify Configuration** 

   - Check the supported ciphers to ensure the vulnerable ones are no longer available: 

     ```bash 

     ssh -Q cipher 

     ``` 

   - Ensure that `chacha20-poly1305@openssh.com` is not listed. 

  

### 6. **Monitor for Exploitation Attempts** 

   - Regularly monitor your logs for any unusual activity that may indicate attempts to exploit this vulnerability. 

  

### 7. **Regular Security Audits** 

   - Conduct regular security audits and vulnerability assessments to ensure that your systems remain secure against known vulnerabilities. 

  

By following these steps, you can effectively mitigate the risks associated with the SSH Terrapin Prefix Truncation Weakness. 
